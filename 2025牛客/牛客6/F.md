#### 题意：

![image-20250802184735232](C:/Users/Henson/AppData/Roaming/Typora/typora-user-images/image-20250802184735232.png)

#### 解：

pre数组维护考察[1,i]的线段树，cost为j的形如[1,x]的区间数量。

dist数组维护，考察[1,i]的线段树，cost为j的区间数量。

枚举i，枚举j。先对pre转移：

如果区间触碰到了右子树，那么需要查两次，否则需要查一次：

pre[i] [j] = (pre[i/2] [j-1]+pre[i/2] [j-2]+pre[i/2+i%2] [j-1]+pre[i/2+i%2] [j-2])

然后除以2取平均，因为是考察中间点在不同段的两种情况。

需要注意的是，j=3时会把[1,i]这个区间意外算进来，需要-1.

由于对称性，pre也可以看作形如[x,i]的区间数量。

考虑完全在左子树或者右子树中的区间，只需要额外查1次，加起来。

否则必然是子树中的一个前缀或者后缀，枚举前缀或后缀的长度然后两个pre相乘即可。

也是额外注意会把[1,i]额外算进来，要-1.