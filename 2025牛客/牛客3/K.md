#### 题意：

![image-20250726152552389](C:/Users/Henson/AppData/Roaming/Typora/typora-user-images/image-20250726152552389.png)

#### 解

记所有前缀最大值所在下标的集合为S，合法排列数有：

![image-20250726153249931](C:/Users/Henson/AppData/Roaming/Typora/typora-user-images/image-20250726153249931.png)

又注意到最后一个前缀最大和的那个数必然是n。

从前往后dpi，j表示，考虑前i个下标，对于某个S，最后一个下标的数最小是j的贡献。

枚举i，j。如果一个位置没有填数，那么可以：

钦定这个位置是前缀最大，fi，j转移到fi+1，大于j的第一个还没有填进来的数。

钦定这个位置不是前缀最大，如果这里有小于j的数可以填，也就是小数还没填完，直接*i转移到fi+1，j

​						如果没有，那么看看j能不能填。假如j不存在，那么j可以填，于是把原来填j						的位置填上大于j的第一个还没有填进来的数，而这里填j。因此*i转移到j转移						到fi+1，大于j的第一个还没有填进来的数。

如果一个位置已经填数了，那么可以：

如果这个位置的数小于j，那么他一定不是前缀最大值，*i直接转移。

如果这个位置的数大于j，那么可以：

钦定这个位置是前缀最大，直接转移到这个位置的那个数。

钦定这个位置不是前缀最大，同理的，把原来填j的位置换成填大于这个位置的数的第一个数，然后这个位置填j，由于中间所有数都不是前缀最大，因为是连续dp的，所以这一个操作不改变原来的前缀最大情况。从而*i转移到fi+1，大于这个位置的数的第一个还没有填进来的数。

最终取fnn为答案。