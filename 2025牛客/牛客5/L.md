#### 题意：

n关，每关p的概率成功。有x个金币，失败时若有金币必须支付一枚继续尝试，否则被送回第一关。问闯完全部n关的期望尝试次数对所有x属于[0,m] .

#### 解：

如果没有金币，那么期望次数为f = (1-p)(f+1) + p*(1-p)(f+2)+p * p * (1-p)(f+3) + ... + p^n * n

化简得到f = (1-p^n) / (1-p)p^n

考察一些状态：（i，j）表示花费i个金币到j关。Pij表示经过该状态的概率，由于每个状态至多经过一次。所以概率的和就是期望。

![image-20250801221754879](C:/Users/Henson/AppData/Roaming/Typora/typora-user-images/image-20250801221754879.png)

考察Pi，n-1.就是闯n关花i个金币的概率，自然是C（n+i-1，i）p^n (1-p)^i

又注意到第一轮失败的概率就是Sx*（1-p）。

所以有答案：S0+……+Sx + Sx（1-p）*f