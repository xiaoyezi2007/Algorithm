#### 题意

一个n*n的网格，每个格子有灯泡，每次游戏点亮一个格子，点亮哪个格子的概率给出。

共2n+2条横竖对角线，多次询问，问某些线全点亮的期望游戏次数。

#### 解

若考虑一个无限长的点亮序列，那么题目在问所有要点亮的格子的集合中，这些格子首次在序列中出现的位置的最大值。通过容斥等价于，对所有子集，集合中有某一个格子第一次出现的下标。

其次数是W/集合中的w和：

![image-20250809183540270](C:/Users/Henson/AppData/Roaming/Typora/typora-user-images/image-20250809183540270.png)

对于每个U想找系数，可以搞成一个生成函数，幂次是Wu，系数是容斥系数。

分拆考察每个点的贡献，是（1-z^wc）

多项式求积得到每一项系数，然后带入就可以了。

预处理所有情况，应当使用dfs顺序，考虑每条线存在或者不存在，这样两种状态之间只需要变化一条线。